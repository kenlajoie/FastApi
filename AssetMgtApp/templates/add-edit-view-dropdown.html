{% include 'layout.html' %}

<div class="container">
  <div class="card">
    <div class="card-header">
        <h5 class="card-title card-title-left">Dropdown</h5>
    </div>
    <div class="card-body">
      {% if mode in ["ADD","ADDX"] %}
      <form id="addDropdownForm">
      {% endif %}
      {% if mode == "EDIT"%}
      <form id="editDropdownForm">
      {% endif %}
      {% if mode == "VIEW"%}
      <form id="viewDropdownForm">
      {% endif %}

            <div class="form-group">
              <input type="text" class="form-control" name="mode" value="{{mode}}" hidden>

            <div class="row g-3 pt-2">
                <div class="col-sm-2">
                    <label for="column" class="form-label-sm">Column</label>
               </div>
               <div class="col-sm-10">
                    {% if mode in ["ADD","EDIT", "VIEW"] %}  <!--column is ready only -->
                        <input id="column" name="column" type="text"
                                style="min-width: 150px; max-width: 200px; text-transform: uppercase;" class="form-control-sm"
                                placeholder="Column" value="{{dropdown.column}}" readonly>
                    {% else %}  <!- ADDX is for adding a new column from the botton ADD button --!>
                        <input id="column" name="column" type="text" autocomplete="off"
                                style="min-width: 150px; max-width: 200px; text-transform: uppercase;" class="form-control-sm"
                                placeholder="column" value="{{dropdown.column}}" required>
                        <div><span id="error-column" class="error"></span></div>
                    {% endif %}
                </div>
            </div> <!--row-->

            <div class="row g-3 pt-2">
                <div class="col-sm-2">
                    <label for="value" class="form-label-sm">Value</label>
               </div>
                <div class="col-sm-10">
                    {% if mode in ["VIEW", "EDIT"] %} <!--column is ready only once added -->
                        <input id=value" name=value type="text"
                                style="min-width: 100px; max-width: 100px;" class="form-control-sm"
                                placeholder="value" value="{{dropdown.value}}" readonly>
                    {% else %} <!- assume ADD or ADDX--!>
                        <input id=value name="value" type="text" autocomplete="off"
                                style="min-width: 100px; max-width: 100px;text-transform: uppercase;" class="form-control-sm"
                                placeholder="value" value="{{dropdown.value}}" required
                                oninput="this.value = this.value.replace(/\s/g, '');"
                                onkeydown="if (event.key === ' ') event.preventDefault();" />
                        <div><span id="error-value" class="error"></span></div>
                    {% endif %}
                </div>
            </div> <!--row-->

            <div class="row g-3 pt-2">
                <div class="col-sm-2">
                    <label for="description" class="form-label-sm">Description</label>
               </div>
                <div class="col-sm-10">
                    {% if mode == "VIEW"%}
                        <input id="description" name="description" type="text"
                                style="min-width: 150px; max-width: 200px;" class="form-control-sm"
                                placeholder="Description" value="{{dropdown.description}}" readonly>
                    {% else %}  <!- assume ADD. ADDX OR edit--!>
                        <input id="description" name="description" type="text" autocomplete="off"
                                style="min-width: 150px; max-width: 200px;" class="form-control-sm"
                                placeholder="Description" value="{{dropdown.description}}" required>
                        <div><span id="error-description" class="error"></span></div>
                    {% endif %}
                </div>
            </div> <!--row-->

            <div class="row g-3 pt-2">
                <div class="col-sm-2">
                    <label for="order" class="form-label-sm">Order</label>
               </div>
                <div class="col-sm-10">
                    {% if mode == "VIEW"%}
                        <input id="order" name="order" type="text"
                                style="min-width: 150px; max-width: 200px;" class="form-control-sm"
                                placeholder="Order" value="{{dropdown.order}}" type="number" readonly>
                    {% else %}  <!- assume ADD, ADDX OR edit--!>
                        <input id="order" name="order" type="text" autocomplete="off"
                                style="min-width: 150px; max-width: 200px;" class="form-control-sm"
                                placeholder="Order" value="{{dropdown.order}}" type="number" required>
                        <div><span id="error-order" class="error"></span></div>
                    {% endif %}
                </div> <!-- col -->
            </div> <!--row-->

            {% if dropdown.column == "MAJORAREA"%}
            <div class="row g-3 pt-1">
                <div class="col-sm-10">
                    <label for="gpslat" class="form-label-sm">Lat:</label>
                    {% if mode == "VIEW"%}
                   <input name=gpsLat id=gpsLat type="number"
                        style="min-width: 110px; max-width: 110px;" class="form-control-sm"
                        placeholder="Latitude" value="{{dropdown.gpsLat}}" readonly>
                     {% else %}  <!- assume ADD OR edit--!>
                    <input name=gpslat id=gpslat type="number" step="0.0000001"
                        style="min-width: 110px; max-width: 110px;" class="form-control-sm"
                        placeholder="Latitude" value="{{dropdown.gpsLat}}" readonly>
                    <span id="error-gpsLat" class="error"></span>
                    {% endif %}

                    <label for="gpslng" class="form-label-sm">Lng:</label>
                    {% if mode == "VIEW"%}
                    <input name=gpsLng id=gpsLng type="number"
                        style="min-width: 110px; max-width: 110px;" class="form-control-sm"
                        placeholder="longitude" value="{{dropdown.gpsLng}}" readonly>
                    {% else %}  <!- assume ADD OR edit--!>
                    <input name=gpslng id=gpslng type="number" step="0.0000001"
                        style="min-width: 110px; max-width: 110px;" class="form-control-sm"
                        placeholder="longitude" value="{{dropdown.gpsLng}}" readonly>
                    <span id="error-gpsLng" class="error"></span>
                    {% endif %}

                    {% if mode in ["ADD","EDIT" ] %}
                            <button name=capture id=capture class="btn-sm btn-primary btn-thin-sm"
                            onclick="getLocation()" type="button">Capture</button>

                        <button name=locate id=locate class="btn-sm btn-primary btn-thin-sm"
                            onclick="clearLocation()" type="button">Clear</button>
                    {% endif %}
                </div> <!-- col -->
            </div> <!--row-->

            <div class="row g-3 pt-1">
                <div class="col-sm-8">
                    <div>
                        <p id="location"></p>
                    </div>
                </div> <!-- col -->
            </div> <!--row-->
            {% endif %}

            {% if mode in ["VIEW", "EDIT"] %}
            <div class="row g-3 pt-1">
                <div class="col-sm-8">
                    <b>&nbsp;Created On:</b> {{dropdown.createdDate}}   <b>By: </b>{{dropdown.createdBy}}
                </div>
            </div> <!--row-->
            <div class="row g-3 pt-1">
                <div class="col-sm-8">
                    <b>Updated On:</b> {{dropdown.updatedDate}}   <b>By: </b>{{dropdown.updatedBy}}
                </div>
            </div> <!--row-->
            {% endif %}

            <div class="row g-3 pt-3 pb-3">
                <div class="col-sm-3">
                   {% if mode == "VIEW" %}
                        <button type="submit"
                             class="btn-sm btn-primary btn-thin-sm">Delete</button>
                   {% else %}  <!- assume ADDX, ADD OR EDIT--!>
                        <button type="submit"
                            class="btn-sm btn-primary btn-thin-sm">Save</button>
                    {% endif %}

                        <button
                            class="btn-sm btn-primary btn-thin-sm"
                            onclick=window.location.href='/dropdown/dropdown-page' type="button">Back</button>
                </div>
            </div> <!--row-->
      </form>
    </div> <!-- card body -->
  </div> <!-- card -->
</div> <!-- container -->


<script>
    function clearLocation() {
        document.getElementById('gpslat').value = null;
        document.getElementById('gpslng').value = null;
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            document.getElementById("location").innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {
        document.getElementById('gpslat').value = position.coords.latitude;;
        document.getElementById('gpslng').value = position.coords.longitude;
    }

    function showError(error) {
        switch (error.code) {
            case error.PERMISSION_DENIED:
                document.getElementById("location").innerHTML = "User denied the request for Geolocation.";
                break;
            case error.POSITION_UNAVAILABLE:
                document.getElementById("location").innerHTML = "Location information is unavailable.";
                break;
            case error.TIMEOUT:
                document.getElementById("location").innerHTML = "The request to get user location timed out.";
                break;
            case error.UNKNOWN_ERROR:
                document.getElementById("location").innerHTML = "An unknown error occurred.";
                break;
        }
    }
</script>
